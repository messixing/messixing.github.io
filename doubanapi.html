layout: false
date: 2015-04-05 20:03:48
---
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1"> 
</head>
<body>   
<input type="text" class="movnum" />
        <input type="button" name="" class="submit" value="查询">
        <input type="text" name="" class="nextpage">
        <p>点击查询将为你查询豆瓣Top 250海报及片名，每次查询20条</p>
    <div class="imgli">
        
    </div>
        <script src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
       <script type="text/javascript">   
       $(function(){       

            var start = 0;
            getdoubanapi(start);
            
             $(".submit").click(function() {
                //var movnum = $(".movnum").val(); 
                $(".imgli").empty();     
                if(sessionStorage.getItem('test') == null || typeof sessionStorage.getItem('test') === "undefind"){
                    start = 0;
                    console.log("111");
                }else{
                    start = sessionStorage.getItem('test');
                    console.log("222");
                    console.log(start);
                    getdoubanapi(start); 
                }
             });
             })
       function getdoubanapi(start){
                 $.ajax({
        type: "get", 
        //url: "http://api.douban.com/v2/movie/subject/" + movnum + "",   电影剧照
        url:"http://api.douban.com/v2/movie/top250?start="+ start + "",
        dataType: 'JSONP',
         //jsonp: "jsoncallback",
        //jsonpCallback:"success_jsonpCallback"，
        success: function (data) {
            //var tmpdata = data.images.large;
           //$("img").attr("src",tmpdata);
           var tmpdata = data.subjects;
           console.log(tmpdata);
           for(var i = 0;i < tmpdata.length;i++){
            var tmpimg = tmpdata[i].images;
            var tmptitle = tmpdata[i].title;
            //console.log(tmpimg.large);
            var imgtep = "<div class='movieli'><p>"+ tmptitle +"</p><img src=" + tmpimg.large + "></div>"
            //console.log(imgtep);
            $(".imgli").append(imgtep);
           }
           start = Number(start) + 20;
            sessionStorage.setItem('test', start);
            console.log(start);
        }
    });
             }
        </script>
</body>
</html>
